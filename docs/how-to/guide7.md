# How to set up a workflow configuration for Radiance simulation?

The workflow configuration can be used to run a two- or three- or five-Phase method simulation in Radiance. This guide will show you how to set up a workflow configuration using the `WorkflowConfig` class. 

The workflow configuration has two parts: settings and model. 

1. `settings` defines the simulation settings, such as number of parallel processes, sky basis, window basis, epw/wea file, latitude, longitude, timezone, site elevation, matrices sampling parameters, etc.
2. `model` defines the model, which includes the scene, windows, materials, sensors, and views.

## Ways to set up a configuration file

**Method 1** Use the `settings` and `model` attributes in the `WorkflowConfig` class to set up the settings and model parameters in the workflow configuration. The `settings` and `model` attributes are instances of the `Settings` and `Model` classes, respectively. 

**Method 2** Use the `from_dict()` method of the `WorkflowConfig` class to generate a workflow configuration by passing a dictionary to the method. The dictionary should contain the settings and model parameters.

## 0. Import the required classes and functions

```python
import frads as fr
```

## 1. Use the `settings` and `model` attributes

### 1.1 Initialize a `WorkflowConfig` instance

```python
cfg = fr.WorkflowConfig()
```

### 1.2 Set up the settings

Use the `settings` attribute to set up the settings. The `settings` attribute is an instance of the `Settings` class. 

The `Settings` class has the following default settings. You can change the default settings by assigning new values to the attributes of the `Settings` class.

??? note "Default settings"
    **name** The name of the simulation. (default="")

    **num_processors**: The number of processors to use for the simulation. (default=1)

    **method**: The Radiance method to use for the simulation.
    **(default="3phase") 

    **overwrite**: Whether to overwrite existing files. (default=False)

    **save_matrices**: Whether to save the matrices generated by the simulation. (default=False)

    **sky_basis**: The sky basis to use for the simulation. (default="r1")

    **window_basis**: The window basis to use for the simulation. (default="kf")

    **non_coplanar_basis**: The non-coplanar basis to use for the simulation. (default="kf")

    **sun_basis**: The sun basis to use for the simulation. (default="r6")

    **sun_culling**: Whether to cull suns. (default=True)

    **separate_direct**: Whether to separate direct and indirect contributions. (default=False)

    **epw_file**: The path to the EPW file to use for the simulation. (default="")

    **wea_file**: The path to the WEA file to use for the simulation. (default="")

    **start_hour**: The start hour for the simulation. (default=8)

    **end_hour**: The end hour for the simulation. (default=18)

    **daylight_hours_only**: Whether to simulate only daylight hours. (default=True)

    **latitude**: The latitude for the simulation. (default=37)

    **longitude**: The longitude for the simulation. (default=122)

    **timezone**: The timezone for the simulation. (default=120)

    **orientation**: sky rotation. (default=0)

    **site_elevation**: The elevation for the simulation. (default=100)

    **sensor_sky_matrix**: The sky matrix sampling parameters. (default_factory=lambda: ["-ab", "6", "-ad", "8192", "-lw", "5e-5"])

    **view_sky_matrix**: View sky matrix sampling parameters. (default_factory=lambda: ["-ab", "6", "-ad", "8192", "-lw", "5e-5"])

    **sensor_sun_matrix**: Sensor sun matrix sampling parameters. (Default_factory=lambda: [ "-ab", "1", "-ad", "256", "-lw", "1e-3", "-dj", "0", "-st", "0"])

    **view_sun_matrix**: View sun matrix sampling parameters.(default_factory=lambda: ["-ab", "1", "-ad", "256", "-lw", "1e-3", "-dj", "0", "-st", "0"])

    **sensor_window_matrix**: Sensor window matrix sampling parameters. (default_factory=lambda: ["-ab", "5", "-ad", "8192", "-lw", "5e-5"])

    **view_window_matrix**: View window matrix sampling parameters. (default_factory=lambda: ["-ab", "5", "-ad", "8192", "-lw", "5e-5"])

    **daylight_matrix**: Daylight matrix sampling parameters. (default_factory=lambda: ["-ab", "2", "-c", "5000"])


```python
# Set the number of parallel processes
cfg.settings.num_processors = 4
```

### 1.2 Set up the model

Use the `model` attribute to set up the model. The `model` attribute is an instance of the `Model` class. 

The `Model` class has the following attributes.

1. `scene`: The scene to use for the simulation. An instance of the `SceneConfig` class.

2. `windows`: The windows to use for the simulation. A dictionary of instances of the `WindowConfig` class.

3. `materials`: The materials to use for the simulation. An instances of the `MaterialConfig` class.

4. `sensors`: The sensors to use for the simulation. A dictionary of instances of the `SensorConfig` class.

5. `views`: The views to use for the simulation. A dictionary of instances of the `ViewConfig` class.

```python title="scene"
scene = fr.SceneConfig()
scene.files = ["walls.rad", "ceiling.rad", "floor.rad", "ground.rad"]
cfg.model.scene = scene
```

??? example "wall.rad"
    geometry primitive
    ```
    wall_mat polygon wall_1
    0
    0
    12 
        0   0   0
        0   0   3
        0   3   3
        0   3   0
    ```


```python title="windows"
window_1 = fr.WindowConfig()
window_1.file = "window_1.rad"
window_1.matrix_file = "window_1.xml"
cfg.model.windows = {"window_1": window_1}
```

??? example "window_1.rad"
    geometry primitive
    ```
    window_mat polygon window_1
    0
    0
    12 
        0   1   1
        0   1   2
        0   2   2
        0   2   1
    ```

```python title="materials"
materials = fr.MaterialConfig()
materials.files = ["materials.mat"]
cfg.model.materials = materials
```

??? example "materials.mat"
    material primitive
    ```
    void plastic wall_mat
    0
    0
    5 0.5 0.5 0.5 0 0
    ```

```python title="sensors"
sensor_1 = fr.SensorConfig()
sensor_1.files = ["sensor_1.txt"]
cfg.model.sensors = {"sensor_1": sensor_1}
```

??? example "sensor_1.txt"
    x_viewpoint y_viewpoint z_viewpoint x_direction y_direction z_direction
    ```
    1 1 1 0 -1 0
    ```

```python title="views"
view_1 = fr.ViewConfig()
view_1.file = "view_1.vf"
view_1.xres = 16
view_1.yres = 16
cfg.model.views = {"view_1": view_1}
```

??? example "view_1.vf"
    view_type view_point view_direction view_up_direction view_horizontal_field_of_view view_vertical_field_of_view view_rotation_angle
    ```
    -vta -vp 1 1 1 -vd 0 -1 0 -vu 0 0 1 -vh 180 -vv 180
    ```

## 2. Use the `from_dict()` method

### 2.1 Initialize a `WorkflowConfig` instance with a dictionary

```python
cfg = fr.WorkflowConfig.from_dict(dict_1)
```

??? example "dict_1"
    ```json
    dict = {
        "settings": {
            "method": "3phase",
            "sky_basis": "r1",
            "epw_file": "",
            "wea_file": "oak.wea",
            "sensor_sky_matrix": ["-ab", "0"],
            "view_sky_matrix": ["-ab", "0"],
            "sensor_window_matrix": ["-ab", "0"],
            "view_window_matrix": ["-ab", "0"],
            "daylight_matrix": ["-ab", "0"]
        },
        "model": {
            "scene": {
                "files": [
                    "walls.rad",
                    "ceiling.rad",
                    "floor.rad",
                    "ground.rad"
                ]
            },
            "windows": {
                "window_1": {
                    "file": "window_1.rad",
                    "matrix_file": "window_1.xml"
                }
            },
            "materials": {
                "files": ["materials.mat"]
            },
            "sensors": {
                "sensor_1": {"file": "sensor_1.txt"}
            },
            "views": {
                "view_1": {
                    "file": "view_1.vf", 
                    "xres": 16,
                    "yres": 16
                }
            }
        }
    }
    ```

!!! tips "Use an EnergyPlus model to set up a workflow configuration"
    You can use the `epjson_to_rad()` function to convert an EnergyPlus model to a Radiance model. The function returns a dictionary of the Radiance model for each exterior zone in the EnergyPlus model. You can use the dictionary to set up the workflow configuration.
        
    ```python
    epmodel = fr.EnergyPlusModel("file.idf") # EnergyPlus model
    radmodel = fr.epjson_to_rad(epmodel) # Radiance model
    dict_zone1 = radmodel["zone_1"] # Get the dictionary of the Radiance model for zone_1.
    ```

    ```python
    cfg = fr.WorkflowConfig.from_dict(dict_zone1)
    ```


