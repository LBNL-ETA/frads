"""Unit tests for frads.color module."""

from pathlib import Path
import sys
sys.path.append(".")

from frads import color
from frads import color_data

def test_rgb2xyz():
    r = 0.3
    g = 0.4
    b = 0.5
    coeffs = color_data.RGB2XYZ_RAD
    x, y, z = color.rgb2xyz(r, g, b, coeffs)
    assert round(x, 6) == 0.364783
    assert round(y, 6) == 0.379968
    assert round(z, 6) == 0.482895

def test_xyz2rgb():
    x = 0.3
    y = 0.4
    z = 0.5
    coeffs = color_data.XYZ2RGB_RAD
    r, g, b = color.xyz2rgb(x, y, z, coeffs)
    assert round(r, 6) == 0.103622
    assert round(g, 6) == 0.506593
    assert round(b, 6) == 0.510249

def test_spec2xyz():
    spect = {360:0, 365:0, 370:0, 375:0.00600000005, 380:0.0370000005, 385:0.0860000029,
        390:0.147, 395:0.210999995, 400:0.268999994, 405:0.317000002, 410:0.354000002,
        415:0.379999995, 420:0.405000001, 425:0.432000011, 430:0.460999995,
        435:0.488000005, 440:0.509000003, 445:0.523999989, 450:0.537, 455:0.551999986,
        460:0.569000006, 465:0.587000012, 470:0.602999985, 475:0.616999984,
        480:0.628000021, 485:0.635999978, 490:0.640999973, 495:0.643999994,
        500:0.647000015, 505:0.65200001 , 510:0.657000005, 515:0.662, 520:0.667999983,
        525:0.675000012, 530:0.683000028, 535:0.68900001, 540:0.694000006,
        545:0.698000014, 550:0.699999988, 555:0.702000022, 560:0.704999983,
        565:0.70599997, 570:0.704999983, 575:0.699000001, 580:0.689999998,
        585:0.677999973, 590:0.666999996, 595:0.660000026, 600:0.657000005,
        605:0.658999979, 610:0.663999975, 615:0.66900003, 620:0.672999978,
        625:0.672999978, 630:0.670000017, 635:0.663999975, 640:0.657000005,
        645:0.649999976, 650:0.644999981, 655:0.640999973, 660:0.638999999,
        665:0.637000024, 670:0.633000016, 675:0.625999987, 680:0.616999984,
        685:0.606000006, 690:0.592999995, 695:0.578999996, 700:0.566999972,
        705:0.558000028, 710:0.551999986, 715:0.549000025, 720:0.549000025,
        725:0.550999999, 730:0.555000007, 735:0.559000015, 740:0.56099999,
        745:0.56099999, 750:0.559000015, 755:0.55400002, 760:0.546000004,
        765:0.536000013, 770:0.523999989, 775:0.513000011, 780:0.500999987,
        785:0.49000001, 790:0.481000006, 795:0.47299999, 800:0.467000008,
        805:0.462000012, 810:0.458999991, 815:0.456999987, 820:0.456999987,
        825:0.456, 830:0.456}
    wvl_range = max(spect.keys()) - min(spect.keys())
    cie_xyz_bar = color.get_interpolated_cie_xyz(spect.keys(), "2")
    x, y, z = color.spec2xyz(cie_xyz_bar, spect.values(), wvl_range, emis=False)
    assert round(x, 8) == 0.64875707
    assert round(y, 8) == 0.67689356
    assert round(z, 8) == 0.53955804


def test_xyz2xy():
    x, y = color.xyz2xy(0.648757039, 0.676893567, 0.539558066)
    assert round(x, 6) == 0.34782
    assert round(y, 6) == 0.362905
